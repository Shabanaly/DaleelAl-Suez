<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุฅุฏุงุฑุฉ ุงูุฃูุณุงู - ุฏููู ุงูุณููุณ</title>
    <script src="../../services/auth.service.js"></script>
    <script>
      AuthService.checkAuth();
    </script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="../../../common/config/config.js"></script>
    <link rel="stylesheet" href="../../css/admin.css" />
    <link rel="stylesheet" href="../../css/modules/categories.css" />
    <link rel="stylesheet" href="../../css/modules/categories-page.css" /> <!-- Required for Grid Styles -->
    
    <script src="../../utils/helpers.js"></script>
    <script src="../../services/supabase.js"></script>
    <script src="../../../common/services/admin/categories.service.js"></script>
    <script src="../../../common/services/translation.service.js"></script>
    
    <!-- UX Improvements -->
    <script src="../../js/ui/toast.js"></script>
    <script src="../../js/utils/ui-utils.js"></script>
    <script src="../../js/utils/keyboard-shortcuts.js"></script>
    
    <script src="../../components/sidebar.js"></script>
    <script src="../../components/topbar.js"></script>
    <script src="../../utils/drawer.js"></script>
    <script src="../../js/pages/categories-list.js" type="module"></script>
    <style>
        .modal-box {
            max-height: 90vh;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="app-layout">
        <div id="sidebar-container"></div>
        <main class="main-content">
            <div id="topbar-container"></div>
            <div class="page-content">
                <div class="categories-header">
                    <h1>
                        <i data-lucide="layers"></i>
                        ุฅุฏุงุฑุฉ ุงูุฃูุณุงู
                    </h1>
                    <div class="header-actions-group">
                        <div class="view-toggle">
                            <button class="btn active" id="view-list-btn" onclick="toggleView('list')" title="ุนุฑุถ ูุงุฆูุฉ">
                                <i data-lucide="list"></i>
                            </button>
                            <button class="btn" id="view-grid-btn" onclick="toggleView('grid')" title="ุนุฑุถ ุดุจูุฉ">
                                <i data-lucide="grid"></i>
                            </button>
                        </div>
                        <div class="separator-vertical"></div>
                        <button class="btn btn-outline" id="open-sub-modal-btn" onclick="openSubModal()">
                            <i data-lucide="git-merge"></i> <span>ุฅุถุงูุฉ ูุฑุนู</span>
                        </button>
                        <a href="categories-form.html" class="btn btn-header-action">
                            <i data-lucide="plus-circle"></i> <span>ุฅุถุงูุฉ ุฑุฆูุณู</span>
                        </a>
                    </div>
                </div>

                <div class="card category-list-card">
                    <div class="category-filter-section">
                        <input type="search" id="search-input" placeholder="๐ ุจุญุซ ุจุงูุงุณู ุฃู ุงููุนุฑู..." class="form-control">
                    </div>
                </div>

                <!-- Table View -->
                <div id="categories-table-view" class="card">
                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ุงูุงุณู</th>
                                    <th>ุงููุนุฑู</th>
                                    <th>ุงูุฃููููุฉ</th>
                                    <th>ุงูุฃูุณุงู ุงููุฑุนูุฉ</th>
                                    <th>ุงูุฅุฌุฑุงุกุงุช</th>
                                </tr>
                            </thead>
                            <tbody id="categories-table-body">
                                <tr><td colspan="5" style="text-align: center; padding: 40px;">ุฌุงุฑู ุงูุชุญููู...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Grid View (Hidden by default) -->
                <div id="categories-grid-view" class="grid-3" style="display: none; margin-top: 24px;">
                    <!-- Rendered by JS -->
                </div>
            </div>
        </main>
    </div>

    <!-- Subcategory Modal -->
    <div id="subcategory-modal" class="modal-overlay">
        <div class="modal-box" onclick="event.stopPropagation()" style="max-width: 500px;">
            <div class="modal-header">
                <h2 class="modal-title">ุฅุถุงูุฉ ูุณู ูุฑุนู ุฌุฏูุฏ</h2>
                <button class="modal-close" id="sub-modal-close" onclick="closeSubModal()">ร</button>
            </div>
            <form id="subcategory-form">
                <div class="form-group">
                    <label class="form-label">ุงููุณู ุงูุฑุฆูุณู *</label>
                    <select id="sub-parent-select" class="form-control" required>
                        <option value="">ุงุฎุชุฑ ุงููุณู ุงูุฑุฆูุณู...</option>
                        <!-- Populated by JS -->
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">ุงูุงุณู ุจุงูุนุฑุจูุฉ *</label>
                    <input type="text" id="sub-name" class="form-control" required placeholder="ูุซุงู: ูุดููุงุช">
                </div>

                <!-- English Name (Hidden but auto-filled) -->
                <div class="form-group" id="group_sub_name_en" style="display: none;">
                    <label class="form-label">Name in English <span class="badge" style="background: var(--primary-soft); color: var(--primary); font-size: 10px;">AUTO</span></label>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="sub-name-en" class="form-control" placeholder="e.g. Grill">
                        <button type="button" class="btn btn-outline btn-icon" onclick="toggleSubEnField()" title="ุฅุฎูุงุก">
                            <i data-lucide="eye-off"></i>
                        </button>
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: -12px;">
                     <button type="button" class="btn btn-outline" style="font-size: 12px; padding: 4px 12px;" onclick="toggleSubEnField()">
                         <i data-lucide="languages" style="width: 14px;"></i> ุฅุถุงูุฉ ุงูุงุณู ุจุงูุฅูุฌููุฒู
                    </button>
                </div>

                <div class="form-group">
                    <label class="form-label">ุงููุนุฑู ูุฑูุฏ (ID) *</label>
                    <div class="input-with-hint">
                         <div style="display: flex; gap: 8px;">
                             <input type="text" id="sub-id" class="form-control" required placeholder="grill" style="text-align: left; direction: ltr;">
                             <button type="button" class="btn btn-outline btn-icon" onclick="generateSubIdFromEn()" title="ุงุณุชุฎุฑุงุฌ ูู ุงูุฅูุฌููุฒู">
                                 <i data-lucide="wand-2"></i>
                             </button>
                         </div>
                        <small class="form-hint">ูุฌุจ ุฃู ูููู ูุฑูุฏุงู ุจุงูุฅูุฌููุฒูุฉ (ูุซู: grill)</small>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i data-lucide="plus"></i> ุฅุถุงูุฉ ุงููุณู ุงููุฑุนู
                    </button>
                    <!-- <button type="button" class="btn btn-secondary" onclick="closeSubModal()">ุฅูุบุงุก</button> -->
                </div>
            </form>
        </div>
    </div>
</body>
</html>
